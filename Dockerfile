# syntax=docker/dockerfile:1
FROM ubuntu:focal

ENV DEBIAN_FRONTEND=noninteractive

# install packages
RUN apt update
RUN apt install -y gcc make 
RUN apt install -y libpolkit-gobject-1-0=0.105-26ubuntu1 libpolkit-agent-1-0=0.105-26ubuntu1 policykit-1=0.105-26ubuntu1
RUN apt install -y python3 nano

# add the user in with home directory
RUN useradd -m unprivileged

# copy the exploit script in
WORKDIR /home/unprivileged

# copy the python files in
COPY finder.py exploit.py example_suid.c ./

# set the executable and SUID bit
RUN gcc -o example_suid example_suid.c
RUN chmod +x *.py
RUN chmod +x example_suid
RUN chmod u+s example_suid

USER unprivileged
CMD ["sleep", "100000000"]