// #!/usr/bin/python3

// from ctypes import CDLL
// from ctypes.util import find_library
// import os
// import pwd

// libc = CDLL(find_library('c'))

// print("Executing as user", pwd.getpwuid(os.getuid())[0])
// user_input = input("Enter some string and I'll try to run it: ")
// libc.execve(user_input)

#include <stdio.h>
#include <string.h>
#include <sys/types.h>
#include <pwd.h>
#include <unistd.h>

int main(int argc, char* argv[]) {
    
    printf("CS443 Team 03 Super-Vulnerable SUID Program\n");
    printf("-------------------------------------------\n");

    // Display the effective user ID
    struct passwd *effective_user = getpwuid(geteuid());
    printf("The current program is run effectively as user: %s\n", effective_user->pw_name);
    
    // Set the USER ID (original runner) to the EFFECTIVE USER ID (suid bit owner)
    setuid(geteuid());

    // Get the program name from the user and store it into variable
    char inp[1000];
    printf("Enter something for this program to start: ");
    scanf("%s", inp);

    // Prepare the arguments for execution
    char* arguments[] = {inp, NULL};
    char* environments[] = { NULL };
    execve(arguments[0], arguments, environments);

}